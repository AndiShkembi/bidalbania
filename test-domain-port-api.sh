#!/bin/bash

echo "üåê Testing Domain API with Port 7700..."
echo "======================================"

echo ""
echo "üìã Step 1: Checking API Configuration..."
echo "---------------------------------------"

# Check if API config uses domain with port 7700
if grep -q "bidalbania.al:7700/api" "frontend/src/config/api.js"; then
    echo "‚úÖ API config uses domain with port 7700"
else
    echo "‚ùå API config does not use domain with port 7700"
fi

# Check if API config uses localhost for development
if grep -q "localhost:7700/api" "frontend/src/config/api.js"; then
    echo "‚úÖ API config uses localhost for development"
else
    echo "‚ùå API config does not use localhost for development"
fi

echo ""
echo "üìã Step 2: Expected Behavior..."
echo "-----------------------------"

echo "‚úÖ Development Environment:"
echo "  ‚Ä¢ localhost:8080 ‚Üí http://localhost:7700/api"
echo "  ‚Ä¢ 127.0.0.1:8080 ‚Üí http://localhost:7700/api"
echo "  ‚Ä¢ Any local port ‚Üí http://localhost:7700/api"
echo ""
echo "‚úÖ Production Environment:"
echo "  ‚Ä¢ bidalbania.al ‚Üí https://bidalbania.al:7700/api"
echo "  ‚Ä¢ www.bidalbania.al ‚Üí https://bidalbania.al:7700/api"
echo "  ‚Ä¢ Any domain access ‚Üí https://bidalbania.al:7700/api"

echo ""
echo "üìã Step 3: Testing Instructions..."
echo "--------------------------------"

echo "üîß Development Testing:"
echo ""
echo "1. Start backend: cd backend && npm start"
echo "2. Start frontend: cd frontend && npm run dev"
echo "3. Open browser: http://localhost:8080"
echo "4. Check console for: 'üîß Development mode: Using localhost API'"
echo "5. Check Network tab for: http://localhost:7700/api calls"
echo ""
echo "üîß Production Testing:"
echo ""
echo "1. Make sure backend is running on port 7700 with SSL"
echo "2. Open browser: https://bidalbania.al"
echo "3. Check console for: 'üöÄ Production mode: Using domain API with port 7700'"
echo "4. Check Network tab for: https://bidalbania.al:7700/api calls"

echo ""
echo "üìã Step 4: Console Messages..."
echo "----------------------------"

echo "‚úÖ Expected Development Messages:"
echo "  ‚Ä¢ 'üîß Development mode: Using localhost API'"
echo "  ‚Ä¢ 'API URL configured as: http://localhost:7700/api'"
echo "  ‚Ä¢ 'CSP: Skipping HTTPS upgrade for local/development'"
echo ""
echo "‚úÖ Expected Production Messages:"
echo "  ‚Ä¢ 'üöÄ Production mode: Using domain API with port 7700'"
echo "  ‚Ä¢ 'API URL configured as: https://bidalbania.al:7700/api'"
echo "  ‚Ä¢ No CSP interference with domain API"

echo ""
echo "üìã Step 5: Network Tab Check..."
echo "-----------------------------"

echo "‚úÖ Development Network Requests:"
echo "  ‚Ä¢ API calls should show: http://localhost:7700/api"
echo "  ‚Ä¢ Status should be 200 (success)"
echo "  ‚Ä¢ No SSL errors"
echo ""
echo "‚úÖ Production Network Requests:"
echo "  ‚Ä¢ API calls should show: https://bidalbania.al:7700/api"
echo "  ‚Ä¢ Status should be 200 (success)"
echo "  ‚Ä¢ SSL handled by backend on port 7700"
echo "  ‚Ä¢ No mixed content errors"

echo ""
echo "‚ö†Ô∏è  Important Notes:"
echo "------------------"

echo "‚Ä¢ Development uses localhost:7700 (no SSL issues)"
echo "‚Ä¢ Production uses bidalbania.al:7700 with HTTPS"
echo "‚Ä¢ Backend must have SSL certificate on port 7700"
echo "‚Ä¢ CSP automatically adapts to environment"
echo ""
echo "‚Ä¢ For production to work:"
echo "  1. SSL certificate must be installed on port 7700"
echo "  2. Backend must be configured for HTTPS on port 7700"
echo "  3. Firewall must allow port 7700"
echo "  4. Domain must point to correct server"

echo ""
echo "üîß Quick Test Commands:"
echo "---------------------"

echo "Development:"
echo "  cd backend && npm start"
echo "  cd frontend && npm run dev"
echo "  # Visit: http://localhost:8080"
echo ""
echo "Production:"
echo "  # Make sure backend has SSL on port 7700"
echo "  # Visit: https://bidalbania.al"

echo ""
echo "üéâ Domain API with Port 7700 Configuration Complete!"
echo "==================================================="
echo ""
echo "‚úÖ Development: Uses localhost:7700 (no SSL issues)"
echo "‚úÖ Production: Uses bidalbania.al:7700 with HTTPS"
echo "‚úÖ CSP: Automatically adapts"
echo "‚úÖ Port 7700 specified for domain API calls" 