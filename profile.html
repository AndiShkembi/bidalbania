<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <title>Profili im - BidAlbania</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="./public/homepage.css" />
  <link rel="stylesheet" type="text/css" href="./public/header.css" />
  <link rel="stylesheet" type="text/css" href="./public/footer.css" />
  <style>
    html, body {
      height: 100%;
      min-height: 100%;
    }
    body {
      background: #f8f8fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .site-wrapper {
      flex: 1 0 auto;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    .main-layout {
      flex: 1 0 auto;
      display: flex;
      gap: 32px;
      max-width: 1200px;
      margin: 40px auto 32px auto;
      align-items: flex-start;
    }
    .suggested-services {
      flex: 1 1 320px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
      padding: 28px 20px 20px 20px;
      min-width: 260px;
      max-width: 340px;
    }
    .suggested-services h2 {
      font-size: 20px;
      color: #10103F;
      margin-bottom: 18px;
      font-family: 'Montserrat', sans-serif;
    }
    .service-card {
      background: #f4f7ff;
      border-radius: 10px;
      margin-bottom: 16px;
      padding: 14px 12px;
      box-shadow: 0 2px 8px rgba(16,16,63,0.04);
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .service-card img {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      object-fit: cover;
    }
    .service-info {
      flex: 1;
    }
    .service-title {
      font-weight: 600;
      color: #10103F;
      font-size: 15px;
      margin-bottom: 2px;
    }
    .service-price {
      color: #1aaf5d;
      font-size: 14px;
      font-weight: 500;
    }
    .service-rating {
      color: #f7b500;
      font-size: 13px;
      margin-left: 6px;
    }
    .profile-main {
      flex: 2 1 520px;
      min-width: 320px;
      max-width: 700px;
    }
    .profile-container {
      max-width: 100%;
      margin: 0 0 32px 0;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.10);
      padding: 40px 32px 32px 32px;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    .profile-container h1 {
      color: #10103F;
      font-family: 'Montserrat', sans-serif;
      font-size: 28px;
      margin-bottom: 18px;
    }
    .profile-info {
      text-align: left;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .profile-info strong {
      color: #10103F;
      font-weight: 600;
    }
    .logout-btn {
      background: #10103F;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-family: 'Montserrat', sans-serif;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #0a0a2a;
    }
    .error-message {
      background: #fee;
      color: #c33;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
      font-family: 'Open Sans', sans-serif;
      display: none;
    }
    .project-info {
      background: #f4f7ff;
      border-radius: 12px;
      padding: 24px 18px 18px 18px;
      margin-bottom: 32px;
      box-shadow: 0 2px 8px rgba(16,16,63,0.04);
      text-align: left;
    }
    .project-info h2 {
      color: #10103F;
      font-size: 20px;
      font-family: 'Montserrat', sans-serif;
      margin-bottom: 10px;
    }
    .project-info ul {
      margin: 0 0 0 18px;
      padding: 0;
      color: #222;
      font-size: 15px;
    }
    .project-info li {
      margin-bottom: 6px;
    }
    .project-info p {
      color: #444;
      font-size: 15px;
      margin-bottom: 8px;
    }
    .request-form-container {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.10);
      padding: 32px 28px 24px 28px;
      margin-bottom: 32px;
      margin-top: 0;
    }
    .request-form-container h2 {
      color: #10103F;
      font-size: 22px;
      font-family: 'Montserrat', sans-serif;
      margin-bottom: 18px;
      text-align: left;
    }
    .request-form .form-group {
      margin-bottom: 18px;
      text-align: left;
    }
    .request-form label {
      display: block;
      margin-bottom: 6px;
      color: #333;
      font-family: 'Open Sans', sans-serif;
      font-weight: 600;
      font-size: 14px;
    }
    .request-form input,
    .request-form select,
    .request-form textarea {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 15px;
      font-family: 'Open Sans', sans-serif;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
      resize: none;
    }
    .request-form input:focus,
    .request-form select:focus,
    .request-form textarea:focus {
      outline: none;
      border-color: #10103F;
    }
    .request-form button {
      background: #10103F;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-family: 'Montserrat', sans-serif;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .request-form button:hover {
      background: #0a0a2a;
    }
    .request-success {
      background: #efe;
      color: #363;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 18px;
      font-size: 14px;
      font-family: 'Open Sans', sans-serif;
      display: none;
    }
    .user-requests-container {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.10);
      padding: 32px 28px 24px 28px;
      margin-bottom: 32px;
    }
    .user-requests-container h2 {
      color: #10103F;
      font-size: 22px;
      font-family: 'Montserrat', sans-serif;
      margin-bottom: 18px;
      text-align: left;
    }
    .user-request-card {
      background: #f4f7ff;
      border-radius: 10px;
      margin-bottom: 16px;
      padding: 14px 12px;
      box-shadow: 0 2px 8px rgba(16,16,63,0.04);
      text-align: left;
    }
    .user-request-title {
      font-weight: 600;
      color: #10103F;
      font-size: 15px;
      margin-bottom: 2px;
    }
    .user-request-status {
      font-size: 13px;
      color: #1aaf5d;
      margin-left: 8px;
    }
    .user-request-date {
      font-size: 13px;
      color: #888;
      margin-left: 8px;
    }
    @media (max-width: 900px) {
      .main-layout {
        flex-direction: column;
        gap: 0;
      }
      .suggested-services, .profile-main {
        max-width: 100%;
        min-width: 0;
      }
    }
    .profile-tabs-container {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.10);
      padding: 0 0 24px 0;
      margin-bottom: 32px;
      min-width: 340px;
      min-height: 520px;
      width: 100%;
      max-width: 700px;
      transition: min-height 0.2s;
      display: flex;
      flex-direction: column;
    }
    .profile-tabs-bar {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #e1e5e9;
      padding: 0 24px;
      background: #f8f8fa;
      border-radius: 18px 18px 0 0;
      position: relative;
    }
    .profile-tab-btn {
      background: none;
      border: none;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      font-weight: 600;
      color: #10103F;
      padding: 12px 10px 8px 10px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: border-color 0.2s, color 0.2s;
      outline: none;
    }
    .profile-tab-btn.active {
      border-bottom: 3px solid #10103F;
      color: #10103F;
    }
    .logout-btn-top {
      margin-left: auto;
      background: #10103F;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      font-size: 15px;
      font-family: 'Montserrat', sans-serif;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 0;
    }
    .logout-btn-top:hover {
      background: #0a0a2a;
    }
    .profile-tabs-content {
      padding: 0 24px;
      min-height: 400px;
      width: 100%;
      box-sizing: border-box;
      overflow-x: hidden;
      overflow-y: auto;
      transition: min-height 0.2s;
      max-width: 100%;
    }
    .profile-tab-content {
      display: none;
      padding-top: 24px;
      width: 100%;
      min-width: 0;
      min-height: 350px;
      box-sizing: border-box;
      max-width: 100%;
    }
    .profile-tab-content.active {
      display: block;
    }
    @media (max-width: 600px) {
      .profile-tab-btn {
        font-size: 13px;
        padding: 8px 4px 6px 4px;
      }
      .profile-tabs-bar {
        padding: 0 4px;
      }
    }
    footer.ha--footer_container {
      flex-shrink: 0;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <div class="site-wrapper">
    <header class="light-theme" data-responsive-mode="true">
      <div class="ha--header ha--header_left" role="menubar">
        <a class="ha--logo" href="index.html" role="menuitem" aria-label="Home">
          <img src="./logo.png" alt="BidAlbania" width="100px"/>
        </a>
      </div>
      <nav class="ha--header ha--header_right ha--mobile_nav_pane scroll-lock" role="menubar">
        <ul class="ha--nav" role="menu">
          <li id="start-a-project" class="ha--nav_dropdown_container">
            <a class="ha--mobile_nav_button" href="index.html" role="menuitem">Filloni një Projekt</a>
          </li>
          <li id="join-our-network"><a href="#" class="ha--mobile_nav_button" role="menuitem">Bashkohuni me rrjetin tonë</a></li>
          <li id="login"><a href="login.html" class="ha--mobile_nav_button" role="menuitem">Identifikohu</a></li>
          <li id="signup"><a href="signup.html" class="ha--mobile_nav_button" role="menuitem">Regjistrohu</a></li>
        </ul>
      </nav>
    </header>
    <div class="main-layout">
      <aside class="suggested-services">
        <h2>Shërbime të njohura</h2>
        <div class="service-card">
          <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=facearea&w=96&q=80" alt="Pastrim">
          <div class="service-info">
            <div class="service-title">Pastrim Shtëpie</div>
            <div class="service-price">nga 1500 Lekë</div>
            <div class="service-rating">★ 4.7</div>
          </div>
        </div>
        <div class="service-card">
          <img src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=facearea&w=96&q=80" alt="Elektricist">
          <div class="service-info">
            <div class="service-title">Shërbime Elektrike</div>
            <div class="service-price">nga 2000 Lekë</div>
            <div class="service-rating">★ 4.8</div>
          </div>
        </div>
        <div class="service-card">
          <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=facearea&w=96&q=80" alt="Hidraulik">
          <div class="service-info">
            <div class="service-title">Hidraulik</div>
            <div class="service-price">nga 1800 Lekë</div>
            <div class="service-rating">★ 4.6</div>
          </div>
        </div>
        <div class="service-card">
          <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=facearea&w=96&q=80" alt="Pikturë">
          <div class="service-info">
            <div class="service-title">Pikturë & Lyerje</div>
            <div class="service-price">nga 2500 Lekë</div>
            <div class="service-rating">★ 4.5</div>
          </div>
        </div>
      </aside>
      <main class="profile-main">
        <div class="profile-tabs-container">
          <div class="profile-tabs-bar">
            <button class="profile-tab-btn active" data-tab="profile-tab">Profili im</button>
            <button class="profile-tab-btn" data-tab="post-request-tab">Posto Kërkesë</button>
            <button class="profile-tab-btn" data-tab="my-requests-tab">Kërkesat e mia</button>
            <button class="logout-btn logout-btn-top" onclick="logout()">Dil</button>
          </div>
          <div class="profile-tabs-content">
            <div id="profile-tab" class="profile-tab-content active">
              <div class="profile-container">
                <h1>Profili im</h1>
                <div class="project-info">
                  <h2>Rreth BidAlbania</h2>
                  <p><strong>BidAlbania</strong> është platforma më e madhe shqiptare për gjetjen dhe rezervimin e shërbimeve të shtëpisë dhe biznesit. Qëllimi ynë është të lidhim klientët me profesionistët më të mirë në çdo qytet të Shqipërisë, duke ofruar transparencë, siguri dhe komoditet.</p>
                  <ul>
                    <li>Rezervoni shërbime të besuara për shtëpinë dhe biznesin tuaj.</li>
                    <li>Krahasoni çmimet dhe shikoni vlerësimet e përdoruesve të tjerë.</li>
                    <li>Profesionistët mund të krijojnë profile, të marrin projekte dhe të rrisin biznesin e tyre.</li>
                    <li>Platformë e sigurt, me pagesa online dhe mbështetje 24/7.</li>
                  </ul>
                  <p><strong>Projekti është në zhvillim aktiv.</strong> Çdo sugjerim apo feedback është i mirëpritur!</p>
                </div>
                <div class="error-message" id="error-message"></div>
                <div class="profile-info" id="profile-info">
                  <p>Loading...</p>
                </div>
              </div>
            </div>
            <div id="post-request-tab" class="profile-tab-content">
              <div class="request-form-container">
                <h2>Posto një kërkesë të re</h2>
                <div class="request-success" id="request-success"></div>
                <form class="request-form" id="request-form">
                  <div class="form-group">
                    <input type="text" id="title" name="title" required placeholder="P.sh. Riparim dritareje">
                  </div>
                  <div class="form-group">
                    <textarea id="description" name="description" rows="3" required placeholder="Përshkruani problemin ose shërbimin që kërkoni..."></textarea>
                  </div>
                  <div class="form-group">
                    <select id="category" name="category" required>
                      <option value="">Zgjidhni kategorinë</option>
                      <option value="Elektricist">Elektricist</option>
                      <option value="Hidraulik">Hidraulik</option>
                      <option value="Pastrim">Pastrim</option>
                      <option value="Pikturë">Pikturë & Lyerje</option>
                      <option value="Mobilieri">Mobilieri</option>
                      <option value="Kopshtari">Kopshtari</option>
                      <option value="Transport">Transport</option>
                      <option value="Tjetër">Tjetër</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <select id="city" name="city" required>
                      <option value="">Zgjidhni qytetin</option>
                      <option value="Tiranë">Tiranë</option>
                      <option value="Durrës">Durrës</option>
                      <option value="Vlorë">Vlorë</option>
                      <option value="Shkodër">Shkodër</option>
                      <option value="Elbasan">Elbasan</option>
                      <option value="Fier">Fier</option>
                      <option value="Berat">Berat</option>
                      <option value="Lushnjë">Lushnjë</option>
                      <option value="Kavajë">Kavajë</option>
                      <option value="Gjirokastër">Gjirokastër</option>
                      <option value="Lezhë">Lezhë</option>
                      <option value="Krujë">Krujë</option>
                      <option value="Kukës">Kukës</option>
                      <option value="Pogradec">Pogradec</option>
                      <option value="Sarandë">Sarandë</option>
                      <option value="Tjetër">Tjetër</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <input type="text" id="address" name="address" placeholder="Adresa e plotë (opsionale)">
                  </div>
                  <div class="form-group">
                    <input type="date" id="desiredDate" name="desiredDate">
                  </div>
                  <div class="form-group">
                    <input type="text" id="budget" name="budget" placeholder="P.sh. 5000 Lekë">
                  </div>
                  <button type="submit">Posto Kërkesën</button>
                </form>
              </div>
            </div>
            <div id="my-requests-tab" class="profile-tab-content">
              <div class="user-requests-container">
                <h2>Kërkesat e mia</h2>
                <div id="user-requests-list">
                  <p>Loading...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <footer class="ha--footer_container">
      <section class="ha--footer_partner-container">
        <div class="center-wrapper">
          <div class="ha--footer_follow-us">
            <h3>Na ndiqni</h3>
            <ul>
              <li><a class="ha--footer_social-icon" rel="noopener" target="_blank" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><defs><style>.cls-1{fill:#333;}</style></defs><g id="Layer_2" data-name="Layer 2"><path class="cls-1" d="M15,3.5A11.5,11.5,0,1,0,26.5,15,11.5,11.5,0,0,0,15,3.5m4.31,7.91H17.16a.78.78,0,0,0-.72.71v.72h2.15v2.88H16.44v5.75H13.56V15.72H11.41V12.84h2.15V11.41A3.2,3.2,0,0,1,16.9,8.53h2.41Z"/></g></svg></a></li>
              <li><a class="ha--footer_social-icon" rel="noopener" target="_blank" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><defs><style>.cls-1{fill:#333;}</style></defs><g id="Layer_2" data-name="Layer 2"><path class="cls-1" d="M18.26,12H20a.3.3,0,0,0,.3-.3V10a.3.3,0,0,0-.3-.3H18.26a.29.29,0,0,0-.3.3v1.73A.29.29,0,0,0,18.26,12Z"/><path class="cls-1" d="M18.62,14a3.94,3.94,0,0,1,.14,1,3.76,3.76,0,1,1-7.52,0,3.56,3.56,0,0,1,.14-1c0-.13.08-.26.13-.38h-2v5.63a1.33,1.33,0,0,0,1.32,1.33h8.44a1.33,1.33,0,0,0,1.32-1.33V13.59H18.49C18.54,13.71,18.58,13.84,18.62,14Z"/><path class="cls-1" d="M15,17.42A2.42,2.42,0,0,0,17.42,15a2.36,2.36,0,0,0-.31-1.18,1.76,1.76,0,0,0-.14-.23,2.44,2.44,0,0,0-2-1,2.41,2.41,0,0,0-2,1,1.14,1.14,0,0,0-.15.23A2.36,2.36,0,0,0,12.58,15,2.42,2.42,0,0,0,15,17.42Z"/><path class="cls-1" d="M15,3.5A11.5,11.5,0,1,0,26.5,15,11.5,11.5,0,0,0,15,3.5Zm6.89,16.22a2.17,2.17,0,0,1-2.17,2.17H10.28a2.16,2.16,0,0,1-2.16-2.17V10.28a2.16,2.16,0,0,1,2.16-2.17h9.44a2.17,2.17,0,0,1,2.17,2.17Z"/></g></svg></a></li>
              <li><a class="ha--footer_social-icon" rel="noopener" target="_blank" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><defs><style>.cls-1{fill:#333;}</style></defs><g id="Layer_2" data-name="Layer 2"><path class="cls-1" d="M15,3.5A11.5,11.5,0,1,0,26.5,15,11.5,11.5,0,0,0,15,3.5M8.53,12.12h2.88v9.35H8.53ZM10,11.41A1.44,1.44,0,1,1,11.41,10,1.44,1.44,0,0,1,10,11.41Zm11.5,10.06H18.59V16.08a1.31,1.31,0,0,0-.49-.87,1.66,1.66,0,0,0-1.2,0l-1.18.57v5.72H12.84V12.12h2.88v.45a4.48,4.48,0,0,1,3.79.13,4.11,4.11,0,0,1,2,3.38Z"/></g></svg></a></li>
              <li><a class="ha--footer_social-icon" rel="noopener" target="_blank" href="#" class="ha--footer_social-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><defs><style>.cls-1{fill:#333;}</style></defs><g id="Layer_2" data-name="Layer 2"><path class="cls-1" d="M15,26.5A11.5,11.5,0,1,0,3.5,15,11.5,11.5,0,0,0,15,26.5M12.7,15.79a1.62,1.62,0,0,1-1.77-.94,1.25,1.25,0,0,1,1-.42,1.9,1.9,0,0,1-1.61-1.56,2.75,2.75,0,0,1,.88-.12,2.11,2.11,0,0,1-1.22-2,26.7,26.7,0,0,1,3.69,1.76,5.47,5.47,0,0,1,1.08,1c.52-1.49,1.16-3,2.25-3.79a.81.81,0,0,1-.21.47,2,2,0,0,1,1.12-.58c-.05.33-.49.52-.76.63.21-.07,1.28-.59,1.4-.29s-.74.49-.89.55l-.33.14a3.14,3.14,0,0,1,3,2.59c0,.11.06.24.08.36a2.36,2.36,0,0,0,1.69-.2,1.72,1.72,0,0,1-1.56,1,3.13,3.13,0,0,0,1.63.18,2.11,2.11,0,0,1-1.72.71c-1.17,5.17-9,7.36-12.66,2a3.59,3.59,0,0,0,5.33-.15C12.25,17.27,11.59,16.31,12.7,15.79Z"/></g></svg></a></li>
            </ul>
          </div>
          <div class="footer-sitemap-terms">
            <p class="ha--footer_copyright">&copy; Copyright 2025 BidAlbania</p>
          </div>
        </div>
      </section>
    </footer>
  </div>
  <script>
    async function loadProfile() {
      const token = localStorage.getItem('token');
      const errorMessage = document.getElementById('error-message');
      const profileInfo = document.getElementById('profile-info');
      if (!token) {
        window.location.href = 'login.html';
        return;
      }
      try {
        const res = await fetch('http://localhost:7700/api/auth/profile', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        if (!res.ok) {
          errorMessage.textContent = data.message || 'Nuk mund të ngarkohet profili.';
          errorMessage.style.display = 'block';
          profileInfo.innerHTML = '';
          if(res.status === 401 || res.status === 403) setTimeout(() => logout(), 1500);
        } else {
          errorMessage.style.display = 'none';
          profileInfo.innerHTML = `
            <p><strong>Emri:</strong> ${data.firstName} ${data.lastName}</p>
            <p><strong>Email:</strong> ${data.email}</p>
            <p><strong>Telefoni:</strong> ${data.phone || '-'} </p>
            <p><strong>Qyteti:</strong> ${data.city || '-'} </p>
            <p><strong>Lloji:</strong> ${data.userType || '-'} </p>
            <p><strong>Regjistruar më:</strong> ${data.createdAt ? new Date(data.createdAt).toLocaleString() : '-'} </p>
          `;
        }
      } catch (err) {
        errorMessage.textContent = 'Gabim në rrjet.';
        errorMessage.style.display = 'block';
        profileInfo.innerHTML = '';
      }
    }

    async function postRequest(e) {
      e.preventDefault();
      const token = localStorage.getItem('token');
      const form = document.getElementById('request-form');
      const successMsg = document.getElementById('request-success');
      successMsg.style.display = 'none';
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      // Validim bazik
      if (!data.title || !data.description || !data.category || !data.city) {
        successMsg.textContent = 'Ju lutem plotësoni të gjitha fushat e detyrueshme.';
        successMsg.style.display = 'block';
        successMsg.style.background = '#fee';
        successMsg.style.color = '#c33';
        return;
      }
      try {
        const res = await fetch('http://localhost:7700/api/requests', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (!res.ok) {
          successMsg.textContent = result.message || 'Gabim në postimin e kërkesës.';
          successMsg.style.display = 'block';
          successMsg.style.background = '#fee';
          successMsg.style.color = '#c33';
        } else {
          successMsg.textContent = result.message || 'Kërkesa u postua me sukses!';
          successMsg.style.display = 'block';
          successMsg.style.background = '#efe';
          successMsg.style.color = '#363';
          form.reset();
          loadUserRequests();
        }
      } catch (err) {
        successMsg.textContent = 'Gabim në rrjet.';
        successMsg.style.display = 'block';
        successMsg.style.background = '#fee';
        successMsg.style.color = '#c33';
      }
    }

    async function loadUserRequests() {
      const token = localStorage.getItem('token');
      const list = document.getElementById('user-requests-list');
      list.innerHTML = '<p>Loading...</p>';
      try {
        const res = await fetch('http://localhost:7700/api/requests', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        if (!res.ok) {
          list.innerHTML = '<p>Nuk mund të ngarkohen kërkesat.</p>';
        } else if (!data.length) {
          list.innerHTML = '<p>Ende nuk keni postuar asnjë kërkesë.</p>';
        } else {
          list.innerHTML = data.map(req => `
            <div class="user-request-card">
              <div class="user-request-title">${req.title} <span class="user-request-status">(${req.status})</span></div>
              <div style="font-size:13px;color:#444;margin-bottom:4px;">${req.category} • ${req.city}</div>
              <div style="font-size:13px;color:#888;">${req.createdAt ? new Date(req.createdAt).toLocaleString() : ''}</div>
              <div style="margin-top:6px;">${req.description}</div>
              ${req.budget ? `<div style='margin-top:4px;font-size:13px;'><strong>Bugeti:</strong> ${req.budget}</div>` : ''}
              ${req.desiredDate ? `<div style='margin-top:2px;font-size:13px;'><strong>Data e dëshiruar:</strong> ${req.desiredDate}</div>` : ''}
              ${req.address ? `<div style='margin-top:2px;font-size:13px;'><strong>Adresa:</strong> ${req.address}</div>` : ''}
            </div>
          `).join('');
        }
      } catch (err) {
        list.innerHTML = '<p>Gabim në rrjet.</p>';
      }
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = 'login.html';
    }

    document.getElementById('request-form').addEventListener('submit', postRequest);
    loadProfile();
    loadUserRequests();

    // Tabs logic
    document.querySelectorAll('.profile-tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.profile-tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.profile-tab-content').forEach(tab => tab.classList.remove('active'));
        this.classList.add('active');
        document.getElementById(this.dataset.tab).classList.add('active');
      });
    });
  </script>
</body>
</html> 